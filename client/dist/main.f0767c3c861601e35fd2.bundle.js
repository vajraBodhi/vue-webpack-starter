webpackJsonp([1],[function(t,i,s){"use strict";s(1);window.map=null,window.mOverlay=null,window.onload=function(){var t='[{"from":[113.26627,23.13171],"to":[108.32754,22.81521],"labels":[null,"广西"],"color":"#ff3a31"},{"from":[113.26627,23.13171],"to":[112.9834,28.11266],"labels":[null,"湖南"],"color":"#ff7e2b"},{"from":[113.26627,23.13171],"to":[115.91004,28.67417],"labels":[null,"江西"],"color":"#ffc726"},{"from":[113.26627,23.13171],"to":[114.34234,30.54539],"labels":[null,"湖北"],"color":"#e9ff20"},{"from":[113.26627,23.13171],"to":[119.29659,26.09982],"labels":[null,"福建"],"color":"#99ff1b"},{"from":[113.26627,23.13171],"to":[106.70722,26.5982],"labels":[null,"贵州"],"color":"#45ff15"},{"from":[113.26627,23.13171],"to":[104.07572,30.65089],"labels":[null,"四川"],"color":"#10ff33"},{"from":[113.26627,23.13171],"to":[120.1536,30.26555],"labels":[null,"浙江"],"color":"#0aff84"},{"from":[113.26627,23.13171],"to":[121.4737,31.23037],"labels":[null,"上海"],"color":"#05ffd9"},{"from":[113.26627,23.13171],"to":[113.75322,34.76571],"labels":[null,"河南"],"color":"#00ccff"}]';window.map=new qq.maps.Map(document.getElementById("map_container"),{zoom:4,center:new qq.maps.LatLng(37.43496995956318,106.92269849999998),mapTypeId:qq.maps.MapTypeId.ROADMAP}),window.mOverlay=new QQMapPlugin.MigrationOverlay(window.map,{data:JSON.parse(t)}),new qq.maps.Label({position:new qq.maps.LatLng(25.735,123.46777777777777),map:window.map,content:"钓鱼岛",style:{borderStyle:"none",color:"#fff",backgroundColor:"transparent"}}),new qq.maps.Label({position:new qq.maps.LatLng(25.9175,124.55138888888888),map:window.map,content:"赤尾屿",offset:new qq.maps.Size(0,-10),style:{borderStyle:"none",color:"#fff",backgroundColor:"transparent"}})}},function(t,i,s){"use strict";var a=s(2);t.exports=a},function(t,i){"use strict";var s={calculateColor:function(t,i){if(0===t.indexOf("#")){var s=t.slice(1),a=parseInt(s.slice(0,2),16),e=parseInt(s.slice(2,4),16),o=parseInt(s.slice(4),16);return"rgba("+a+","+e+","+o+","+i+")"}return/^rgb\(/.test(t)?t.replace(/rgb/,"rgba").replace(")",",")+i+")":t.split(",").splice(0,3).join(",")+i+")"}},a={forEach:function(t,i,s){if("function"==typeof Array.prototype.forEach)t.forEach(i,s);else for(var a=0,e=t.length;a<e;a++)i.apply(s,[t[a],a,t])},map:function(t,i,s){if("function"==typeof Array.prototype.map)return t.map(i,s);for(var a=[],e=0,o=t.length;e<o;e++)a[e]=i.apply(s,[t[e],e,t]);return a}},e=function(){var t=function(t){this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.style=t.style,this.color=t.color,this.size=t.size,this.borderWidth=t.borderWidth,this.borderColor=t.borderColor};return t.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.lineWidth=this.borderWidth||0,t.strokeStyle=this.borderColor||"#000",t.fillStyle=this.color||"#000",t.beginPath(),"circle"===this.style?t.arc(0,0,this.size,0,2*Math.PI,!1):"arrow"===this.style&&(t.moveTo(-this.size,-this.size),t.lineTo(this.size,0),t.lineTo(-this.size,this.size),t.lineTo(-this.size/4,0),t.lineTo(-this.size,-this.size)),t.closePath(),t.stroke(),t.fill(),t.restore()},t}(),o=function(){var t=function(t){var i=t.startX,s=t.startY,a=t.endX,e=t.endY,o=Math.sqrt(Math.pow(i-a,2)+Math.pow(s-e,2)),r=(i+a)/2,n=(s+e)/2,h=1.5,l=(s-e)*h+r,c=(a-i)*h+n,d=Math.sqrt(Math.pow(o/2,2)+Math.pow(o*h,2)),p=Math.atan2(s-c,i-l),f=Math.atan2(e-c,a-l);this.startX=i,this.startY=s,this.endX=a,this.endY=e,this.centerX=l,this.centerY=c,this.startAngle=p,this.endAngle=f,this.startLabel=t&&t.labels&&t.labels[0],this.endLabel=t&&t.labels&&t.labels[1],this.radius=d,this.lineWidth=t.width||1,this.strokeStyle=t.color||"#000",this.shadowBlur=t.shadowBlur};return t.prototype.draw=function(t){if(t.save(),t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle,t.shadowColor=this.strokeStyle,t.shadowBlur=this.shadowBlur||2,t.beginPath(),t.arc(this.centerX,this.centerY,this.radius,this.startAngle,this.endAngle,!1),t.stroke(),t.restore(),t.save(),t.fillStyle=this.strokeStyle,t.font="15px sans-serif",this.startLabel){var i=this.startLabel.indexOf("澳门")!==-1?this.startX-20:this.startX,s=this.startLabel.indexOf("澳门")!==-1?this.startY+25:this.startY;t.fillText(this.startLabel,i,s)}if(this.endLabel){var i=this.endLabel.indexOf("澳门")!==-1?this.endX-20:this.endX,s=this.endLabel.indexOf("澳门")!==-1?this.endY+25:this.endY;t.fillText(this.endLabel,i,s)}t.restore()},t}(),r=function(){function t(t){this.x=t.x,this.y=t.y,this.maxRadius=t.radius,this.color=t.color,this.shadowBlur=5,this.lineWidth=t.borderWidth,this.r=0,this.factor=2/t.radius}return t.prototype.draw=function(t){var i=.5;this.r+=i,t.save(),t.translate(this.x,this.y);var a=this.color;a=s.calculateColor(a,1-this.r/this.maxRadius),t.strokeStyle=a,t.shadowBlur=this.shadowBlur,t.shadowColor=a,t.lineWidth=this.lineWidth,t.beginPath(),t.arc(0,0,this.r,0,2*Math.PI,!1),t.stroke(),t.restore(),Math.abs(this.maxRadius-this.r)<.8&&(this.r=0)},t}(),n=function(){var t=function(t){var i=t.startX,s=t.startY,a=t.endX,o=t.endY,r=Math.sqrt(Math.pow(i-a,2)+Math.pow(s-o,2)),n=(i+a)/2,h=(s+o)/2,l=1.5,c=(s-o)*l+n,d=(a-i)*l+h,p=Math.sqrt(Math.pow(r/2,2)+Math.pow(r*l,2)),f=Math.atan2(s-d,i-c),u=Math.atan2(o-d,a-c);f*u<0&&(f<0?(f+=2*Math.PI,u+=2*Math.PI):u+=2*Math.PI),this.tailPointsCount=5,this.centerX=c,this.centerY=d,this.startAngle=f,this.endAngle=u,this.radius=p,this.lineWidth=t.width||5,this.strokeStyle=t.color||"#000",this.factor=2/this.radius,this.deltaAngle=80/Math.min(this.radius,400)/this.tailPointsCount,this.trailAngle=this.startAngle,this.arcAngle=this.startAngle,this.animateBlur=!0,this.marker=new e({x:50,y:80,rotation:50*Math.PI/180,style:"circle",color:"rgb(255, 255, 255)",size:1.5,borderWidth:0,borderColor:this.strokeStyle})};return t.prototype.drawArc=function(t,i,s,a,e){t.save(),t.lineWidth=s,t.strokeStyle=i,t.shadowColor=this.strokeStyle,t.lineCap="round",t.beginPath(),t.arc(this.centerX,this.centerY,this.radius,a,e,!1),t.stroke(),t.restore()},t.prototype.draw=function(t){var i=this.endAngle,a=this.trailAngle+(i-this.startAngle)*this.factor,e=this.strokeStyle;this.animateBlur&&(this.arcAngle=a),this.trailAngle=a,e=s.calculateColor(e,.1),this.drawArc(t,e,this.lineWidth,this.startAngle,this.arcAngle);for(var o=this.tailPointsCount,r=0;r<o;r++){var n=s.calculateColor(this.strokeStyle,.3-.3/o*r),h=5;this.trailAngle-this.deltaAngle*r>this.startAngle&&this.drawArc(t,n,h-h/o*r,this.trailAngle-this.deltaAngle*r,this.trailAngle)}t.save(),t.translate(this.centerX,this.centerY),this.marker.x=Math.cos(this.trailAngle)*this.radius,this.marker.y=Math.sin(this.trailAngle)*this.radius,this.marker.rotation=this.trailAngle+Math.PI/2,this.marker.draw(t),t.restore(),180*(i-this.trailAngle)/Math.PI<.5&&(this.trailAngle=this.startAngle,this.animateBlur=!1)},t}(),h=function(t){this.data=t.data,this.store={arcs:[],markers:[],pulses:[],sparks:[]},this.playAnimation=!0,this.started=!1,this.context=t.context,this.init()};h.prototype.init=function(){this.updateData(this.data)},h.prototype.add=function(t){},h.prototype.remove=function(){},h.prototype.clear=function(){this.store={arcs:[],markers:[],pulses:[],sparks:[]},this.playAnimation=!0,this.started=!1,window.cancelAnimationFrame(this.requestAnimationId)},h.prototype.updateData=function(t){t&&0!==t.length&&(this.clear(),this.data=t,this.data&&this.data.length>0&&a.forEach(this.data,function(t){var i=new o({startX:t.from[0],startY:t.from[1],endX:t.to[0],endY:t.to[1],labels:t.labels,width:1,color:t.color}),s=new e({x:t.to[0],y:t.to[1],rotation:i.endAngle+Math.PI/2,style:"circle",color:t.color,size:2,borderWidth:0,borderColor:t.color}),a=new r({x:t.to[0],y:t.to[1],radius:25,color:t.color,borderWidth:3}),h=new n({startX:t.from[0],startY:t.from[1],endX:t.to[0],endY:t.to[1],width:15,color:t.color});this.store.arcs.push(i),this.store.markers.push(s),this.store.pulses.push(a),this.store.sparks.push(h)},this))},h.prototype.start=function(t){var i=this;this.started||(!function s(){if(i.requestAnimationId=window.requestAnimationFrame(s,t),i.playAnimation){t.width+=1,t.width-=1;for(var a in i.store)for(var e=i.store[a],o=0,r=e.length;o<r;o++)e[o].draw(i.context)}}(),this.started=!0)},h.prototype.play=function(){this.playAnimation=!0},h.prototype.pause=function(){this.playAnimation=!1};var l=window.QQMapPlugin=window.QQMapPlugin||{},c=function(t,i){this.setMap(t),this.config=i,qq.maps.Overlay.call(this),this.mapHandles=[]};c.prototype=new qq.maps.Overlay,c.prototype.construct=function(){if(this.config.canvas=document.createElement("canvas"),this.config.context=this.config.canvas.getContext("2d"),this.getPanes().overlayLayer.appendChild(this.config.canvas),this.resize(),!this.migration){var t=this.convertData();this.migration=new h({data:t,context:this.config.context}),this.bindMapEvents()}this.constructed=!0,this.draging=!1},c.prototype.bindMapEvents=function(){var t=this;this.mapHandles.push(qq.maps.event.addListener(t.map,"bounds_changed",function(){console.info("bounds_changed"),t.draw()})),window.onresize=function(){t.resize()},this.mapHandles.push(qq.maps.event.addListener(t.map,"dragstart",function(){console.info("map dragstart"),t.pause()})),this.mapHandles.push(qq.maps.event.addListener(t.map,"dragend",function(){console.info("map dragend"),t.play(),t.draw()}))},c.prototype.resize=function(){var t=window.getComputedStyle(this.map.getContainer());this.config.canvas.style.position="absolute",this.config.canvas.className="migration-overlay",this.config.canvas.setAttribute("width",parseInt(t.width,10)),this.config.canvas.setAttribute("height",parseInt(t.height,10))},c.prototype.transform=function(){var t=this.map.getBounds();if(t){var i=new qq.maps.LatLng(t.getNorthEast().getLat(),t.getSouthWest().getLng()),s=this.getProjection(),a=s.fromLatLngToDivPixel(i);this.config.canvas.style.transform="translate("+Math.round(a.x)+"px,"+Math.round(a.y)+"px)"}},c.prototype.convertData=function(){var t=this.map.getBounds();if(this.config&&this.config.data&&t){var i=new qq.maps.LatLng(t.getNorthEast().getLat(),t.getSouthWest().getLng()),s=this.getProjection(),e=s.fromLatLngToDivPixel(i),o=a.map(this.config.data,function(t){var i=s.fromLatLngToDivPixel(new qq.maps.LatLng(t.from[1],t.from[0])),a=s.fromLatLngToDivPixel(new qq.maps.LatLng(t.to[1],t.to[0]));return{from:[i.getX()-e.x,i.getY()-e.y],to:[a.getX()-e.x,a.getY()-e.y],labels:t.labels,value:t.value,color:t.color}},this);return o}},c.prototype.setData=function(t){this.config.data=t,this.draw()},c.prototype.show=function(){this.config.canvas.style.display=""},c.prototype.hide=function(){this.config.canvas.style.display="none"},c.prototype.draw=function(){var t=this.map.getBounds();if(t&&this.migration.playAnimation){this.transform();var i=this.convertData();this.migration.updateData(i),this.migration.start(this.config.canvas)}},c.prototype.pause=function(){this.migration.pause()},c.prototype.play=function(){this.migration.play()},c.prototype.destroy=function(){this.migration.clear(),this.config.canvas.parentNode.removeChild(this.config.canvas),a.forEach(this.mapHandles,function(t){qq.mpas.event.removeListener(t)}),this.mapHandles=[]},l.MigrationOverlay=c,t.exports=c}]);
//# sourceMappingURL=main.f0767c3c861601e35fd2.bundle.map